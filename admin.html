<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vanguard Client Telemetry - Single View</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { red: '#be1e2d', dark: '#1e293b' }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* 隐藏默认滚动条，使用自定义样式 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* 侧边栏激活样式 */
        .nav-link.active { 
            background-color: #334155; 
            color: white; 
            border-left: 3px solid #be1e2d;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans h-screen flex overflow-hidden">

    <aside class="w-64 bg-slate-900 text-slate-400 flex flex-col flex-shrink-0 z-20 shadow-xl">
        <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-900 flex-shrink-0">
            <div class="font-bold text-lg text-white tracking-tight">
                Vanguard <span class="text-brand-red">Telemetry</span>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <a href="#overview" class="nav-link block px-6 py-3 hover:bg-slate-800 hover:text-white transition-colors flex items-center">
                <i class="ph ph-squares-four text-xl mr-3"></i> Overview
            </a>
            <a href="#behavior" class="nav-link block px-6 py-3 hover:bg-slate-800 hover:text-white transition-colors flex items-center">
                <i class="ph ph-cursor-click text-xl mr-3"></i> Behavioral Metrics
            </a>
            <a href="#system" class="nav-link block px-6 py-3 hover:bg-slate-800 hover:text-white transition-colors flex items-center">
                <i class="ph ph-server text-xl mr-3"></i> System Health
            </a>
            <a href="#sessions" class="nav-link block px-6 py-3 hover:bg-slate-800 hover:text-white transition-colors flex items-center">
                <i class="ph ph-users text-xl mr-3"></i> Session Explorer
            </a>
            <a href="#settings" class="nav-link block px-6 py-3 hover:bg-slate-800 hover:text-white transition-colors flex items-center">
                <i class="ph ph-gear text-xl mr-3"></i> Settings
            </a>
        </nav>
        
        <div class="p-4 border-t border-slate-800 text-xs text-slate-500 text-center">
            &copy; 2025 Vanguard Internal
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden">
        
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 shadow-sm flex-shrink-0 z-10">
            <h2 class="text-xl font-bold text-slate-800">Admin Dashboard</h2>
            <div class="flex items-center space-x-4">
                <div class="flex items-center text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded border border-green-100">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse mr-2"></span>
                    Live Monitoring
                </div>
            </div>
        </header>

        <div id="main-scroll" class="flex-1 overflow-y-auto p-8 space-y-12 scroll-smooth">

            <section id="overview" class="scroll-mt-6">
                <div class="flex items-center gap-2 mb-6">
                    <i class="ph ph-squares-four text-2xl text-brand-red"></i>
                    <h2 class="text-2xl font-bold text-slate-800">Overview</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Active Sessions</div>
                        <div class="text-3xl font-bold text-slate-800">1,248</div>
                        <div class="text-green-600 text-xs mt-2">↑ 12% vs last hour</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">High Risk</div>
                        <div class="text-3xl font-bold text-brand-red">42</div>
                        <div class="text-red-600 text-xs mt-2">Requires attention</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Avg Frustration</div>
                        <div class="text-3xl font-bold text-amber-500">34.2</div>
                        <div class="text-slate-400 text-xs mt-2">Moderate</div>
                    </div>
                    <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                        <div class="text-slate-500 text-xs font-bold uppercase tracking-wider mb-1">Error Rate</div>
                        <div class="text-3xl font-bold text-slate-800">2.1%</div>
                        <div class="text-green-600 text-xs mt-2">Healthy</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm lg:col-span-2">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">Real-Time Frustration Score</h3>
                        <div class="h-64 w-full">
                            <canvas id="overviewChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">Top Risk Sessions</h3>
                        <div id="risk-list" class="space-y-3"></div>
                    </div>
                </div>
            </section>
            
            <hr class="border-slate-200">

            <section id="behavior" class="scroll-mt-6">
                <div class="flex items-center gap-2 mb-6">
                    <i class="ph ph-cursor-click text-2xl text-brand-red"></i>
                    <h2 class="text-2xl font-bold text-slate-800">Behavioral Metrics</h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">Navigation Action Counts</h3>
                        <div class="h-64">
                            <canvas id="behaviorChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">Frustration Signals</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded border border-red-100">
                                <span class="text-sm font-medium text-red-900">Rage Clicks (Last 1h)</span>
                                <span class="text-xl font-bold text-red-700">45</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-amber-50 rounded border border-amber-100">
                                <span class="text-sm font-medium text-amber-900">Dead Clicks</span>
                                <span class="text-xl font-bold text-amber-700">120</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-slate-50 rounded border border-slate-100">
                                <span class="text-sm font-medium text-slate-700">Form Loops</span>
                                <span class="text-xl font-bold text-slate-700">85</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <hr class="border-slate-200">

            <section id="system" class="scroll-mt-6">
                <div class="flex items-center gap-2 mb-6">
                    <i class="ph ph-server text-2xl text-brand-red"></i>
                    <h2 class="text-2xl font-bold text-slate-800">System Health</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">API Failures (Top Endpoints)</h3>
                        <div class="h-56">
                            <canvas id="systemChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm">Avg Latency (ms)</h3>
                        <div class="h-56">
                            <canvas id="latencyChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <hr class="border-slate-200">

            <section id="sessions" class="scroll-mt-6">
                <div class="flex items-center gap-2 mb-6">
                    <i class="ph ph-users text-2xl text-brand-red"></i>
                    <h2 class="text-2xl font-bold text-slate-800">Session Explorer</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[500px]">
                    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col">
                        <div class="p-3 bg-slate-50 border-b border-slate-200 font-bold text-xs uppercase text-slate-500">Recent Sessions</div>
                        <div id="session-list-container" class="overflow-y-auto p-2 space-y-2 flex-1">
                            </div>
                    </div>

                    <div class="bg-white rounded-xl border border-slate-200 shadow-sm lg:col-span-2 overflow-hidden flex flex-col">
                         <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                            <div>
                                <span class="font-bold text-slate-800">SES-8824</span>
                                <span class="text-xs text-slate-500 ml-2">Retail • Buy Stock</span>
                            </div>
                            <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold">Score: 92</span>
                         </div>
                         <div class="p-6 overflow-y-auto flex-1">
                             <div class="relative pl-4 border-l border-slate-200 ml-2" id="timeline-container">
                                </div>
                         </div>
                    </div>
                </div>
            </section>

            <hr class="border-slate-200">
            
            <section id="settings" class="scroll-mt-6 mb-20">
                <div class="flex items-center gap-2 mb-6">
                    <i class="ph ph-gear text-2xl text-brand-red"></i>
                    <h2 class="text-2xl font-bold text-slate-800">Settings</h2>
                </div>
                
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm max-w-2xl">
                    <div class="space-y-6">
                         <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Frustration Threshold</label>
                            <input type="range" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-brand-red" min="0" max="100" value="70">
                            <div class="flex justify-between text-xs text-slate-400 mt-1">
                                <span>Sensitive (0)</span>
                                <span>Strict (100)</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-slate-700">Enable Synthetic Monitoring</span>
                            <div class="w-10 h-5 bg-green-500 rounded-full relative cursor-pointer">
                                <div class="absolute right-1 top-1 w-3 h-3 bg-white rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // --- 1. Data Rendering Logic ---
        const sessions = [
            { id: 'SES-8824', type: 'Retail', flow: 'Buy Stock', score: 92, risk: 'High', time: '12m' },
            { id: 'SES-8821', type: 'Advisor', flow: 'Buy ETF', score: 85, risk: 'High', time: '2m' },
            { id: 'SES-8823', type: 'Retail', flow: 'Open Account', score: 65, risk: 'Med', time: '8m' },
            { id: 'SES-8825', type: 'Inst.', flow: 'Transfer', score: 12, risk: 'Low', time: '15m' },
            { id: 'SES-8826', type: 'Retail', flow: 'Login', score: 8, risk: 'Low', time: '18m' },
        ];

        const timelineEvents = [
            { type: 'nav', label: 'Entered Flow', time: '10:00:01', status: 'normal' },
            { type: 'system', label: 'API Timeout', time: '10:00:16', status: 'error' },
            { type: 'behavior', label: 'Rage Click (5x)', time: '10:00:18', status: 'warning' },
            { type: 'help', label: 'Help Modal', time: '10:00:25', status: 'info' },
        ];

        function renderComponents() {
            // Render Risk List (Overview)
            document.getElementById('risk-list').innerHTML = sessions.slice(0,3).map(s => `
                <div class="flex justify-between items-center p-3 bg-slate-50 border border-slate-100 rounded-lg">
                    <div>
                        <div class="text-sm font-bold text-slate-700">${s.id}</div>
                        <div class="text-xs text-slate-500">${s.flow}</div>
                    </div>
                    <div class="bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded">${s.score}</div>
                </div>
            `).join('');

            // Render Session List (Explorer)
            document.getElementById('session-list-container').innerHTML = sessions.map(s => `
                <div class="p-3 border border-slate-100 rounded bg-white hover:bg-slate-50 cursor-pointer ${s.id === 'SES-8824' ? 'ring-1 ring-blue-300 bg-blue-50' : ''}">
                    <div class="flex justify-between">
                        <span class="text-sm font-medium text-slate-700">${s.id}</span>
                        <span class="text-xs font-bold ${s.risk==='High'?'text-red-600':'text-slate-500'}">${s.risk}</span>
                    </div>
                    <div class="text-xs text-slate-400 mt-1">${s.flow} • ${s.time}</div>
                </div>
            `).join('');

            // Render Timeline
            document.getElementById('timeline-container').innerHTML = timelineEvents.map(e => `
                <div class="relative pl-6 pb-6 last:pb-0">
                    <div class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full ${e.status === 'error' ? 'bg-red-500' : e.status==='warning'?'bg-amber-500':'bg-slate-300'} ring-4 ring-white"></div>
                    <div class="flex justify-between items-start">
                        <span class="text-sm font-medium text-slate-700">${e.label}</span>
                        <span class="text-xs text-slate-400 font-mono">${e.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // --- 2. Chart Initialization ---
        function initCharts() {
            const commonOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } };

            // Overview Chart
            new Chart(document.getElementById('overviewChart'), {
                type: 'line',
                data: {
                    labels: ['10:00', '10:10', '10:20', '10:30', '10:40'],
                    datasets: [{
                        data: [20, 25, 60, 55, 80],
                        borderColor: '#be1e2d',
                        backgroundColor: 'rgba(190, 30, 45, 0.05)',
                        fill: true, tension: 0.4, pointRadius: 0
                    }]
                },
                options: { ...commonOptions, scales: { x: { display: false }, y: { display: false } } }
            });

            // Behavior Chart
            new Chart(document.getElementById('behaviorChart'), {
                type: 'bar',
                data: {
                    labels: ['Enter', 'Next', 'Back', 'Retry'],
                    datasets: [{ data: [1200, 1100, 300, 200], backgroundColor: '#64748b', borderRadius: 4 }]
                },
                options: commonOptions
            });

            // System Chart
            new Chart(document.getElementById('systemChart'), {
                type: 'bar',
                indexAxis: 'y',
                data: {
                    labels: ['/trade', '/kyc', '/quote'],
                    datasets: [{ data: [12, 8, 2], backgroundColor: '#be1e2d', borderRadius: 2 }]
                },
                options: commonOptions
            });

            // Latency Chart
            new Chart(document.getElementById('latencyChart'), {
                type: 'bar',
                data: {
                    labels: ['Profile', 'Quote', 'Trade'],
                    datasets: [{ data: [120, 45, 450], backgroundColor: '#334155', borderRadius: 4 }]
                },
                options: commonOptions
            });
        }

        // --- 3. Scroll Spy (Highlight Sidebar on Scroll) ---
        function initScrollSpy() {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            const mainContainer = document.getElementById('main-scroll');

            // Use IntersectionObserver to detect which section is in view
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Remove active class from all
                        navLinks.forEach(link => link.classList.remove('active'));
                        // Add active class to corresponding link
                        const id = entry.target.getAttribute('id');
                        const activeLink = document.querySelector(`.nav-link[href="#${id}"]`);
                        if (activeLink) activeLink.classList.add('active');
                    }
                });
            }, {
                root: mainContainer, // Observe scrolling within the main container
                threshold: 0.5 // Trigger when 50% of the section is visible
            });

            sections.forEach(section => observer.observe(section));
        }

        // --- Run ---
        window.addEventListener('DOMContentLoaded', () => {
            renderComponents();
            initCharts();
            initScrollSpy();
        });
    </script>
</body>
</html>